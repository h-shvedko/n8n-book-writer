{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "WPI Chapter JSON Schema",
  "description": "Schema for validated chapter output from WF-3 Chapter Builder. Used by Schema Validator (WF-3) and Schema Pre-Check (WF-5).",
  "type": "object",
  "required": ["chapter_id", "title", "metadata", "sections", "summary", "assessment"],
  "properties": {
    "chapter_id": {
      "type": "string",
      "description": "Unique chapter identifier (e.g. 1.1)"
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "description": "Chapter title"
    },
    "domain_id": {
      "type": "string",
      "description": "Domain identifier (e.g. D1)"
    },
    "metadata": {
      "type": "object",
      "required": ["header", "learning_objectives", "professional_context"],
      "properties": {
        "header": { "type": "string", "minLength": 1 },
        "workload_minutes": { "type": "number" },
        "domain_id": { "type": "string" },
        "learning_objectives": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["id", "description"],
            "properties": {
              "id": { "type": "string" },
              "description": { "type": "string" }
            }
          }
        },
        "professional_context": { "type": "string", "minLength": 1 },
        "chapter_intro": { "type": "string" }
      }
    },
    "sections": {
      "type": "array",
      "minItems": 1,
      "description": "One entry per Learning Objective, built via push() in JSON accumulator",
      "items": {
        "type": "object",
        "required": ["lo_id", "theory_content", "key_takeaway"],
        "properties": {
          "lo_id": { "type": "string" },
          "description": { "type": "string" },
          "bloom_level": { "type": "string" },
          "theory_content": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "properties": {
                "heading": { "type": "string" },
                "paragraphs": { "type": "array", "items": { "type": "string" } },
                "definition": { "type": "object" },
                "best_practice": { "type": "string" },
                "pitfall": { "type": "string" },
                "code_request": { "type": "string" }
              }
            }
          },
          "key_takeaway": { "type": "string", "minLength": 1 },
          "key_terms": { "type": "array", "items": { "type": "string" } },
          "code_examples": { "type": "array" }
        }
      }
    },
    "summary": {
      "type": "string",
      "minLength": 1,
      "description": "Chapter synthesis/summary from Closer phase"
    },
    "assessment": {
      "type": "object",
      "required": ["mcqs", "drill"],
      "properties": {
        "scenario_resolution": { "type": "string" },
        "key_takeaways": { "type": "array", "items": { "type": "string" } },
        "mcqs": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["question", "options", "correct"],
            "properties": {
              "question": { "type": "string" },
              "options": { "type": "array", "minItems": 2, "items": { "type": "string" } },
              "correct": { "type": "string" },
              "explanation": { "type": "string" }
            }
          }
        },
        "drill": {
          "type": "object",
          "required": ["description"],
          "properties": {
            "description": { "type": "string" },
            "requirements": { "type": "array", "items": { "type": "string" } },
            "starter_hint": { "type": "string" }
          }
        }
      }
    }
  }
}
